# PRD-001: HR-AI Agent

| 項目 | 内容 |
|------|------|
| ドキュメントID | PRD-001 |
| バージョン | 1.0.0 |
| ステータス | Draft |
| 作成日 | 2026-02-18 |
| 最終更新日 | 2026-02-18 |
| オーナー | 未定 |

---

## 目次

1. [Overview（概要）](#1-overview)
2. [Background & Problem（背景と課題）](#2-background--problem)
3. [Goals & Non-Goals（ゴールと非ゴール）](#3-goals--non-goals)
4. [Core Value Proposition](#4-core-value-proposition)
5. [User Stories & Personas](#5-user-stories--personas)
6. [Functional Requirements（機能要件）](#6-functional-requirements)
7. [Non-Functional Requirements（非機能要件）](#7-non-functional-requirements)
8. [Phased Delivery Plan（フェーズ計画）](#8-phased-delivery-plan)
9. [Success Metrics（成功指標）](#9-success-metrics)
10. [Risks & Mitigations（リスクと対策）](#10-risks--mitigations)
11. [Appendix（用語集・補足）](#11-appendix)

---

## 1. Overview

### プロダクト名

**HR-AI Agent**

### 一言説明

社長の自然言語チャット指示を AI が解釈してドラフトを生成し、人間が承認する Human-in-the-loop 型の人事・給与変更自動化システム。

### スコープ

給与変更・入退社・労働条件変更などの人事業務を対象に、Google Chat への非構造化テキスト入力から、Web 管理画面での確認・承認、および外部システム（SmartHR・社労士・スプレッドシート）への連携までの一連のフローを自動化する。

---

## 2. Background & Problem

### 2.1 現状の業務フロー

現状、人事に関する指示は社長から Google Chat を通じて五月雨式に届き、担当者が手動で内容を解読・計算・各所に転記している。このフローには以下の構造的問題がある。

### 2.2 課題一覧

| # | 課題 | 影響 |
|---|------|------|
| P1 | 社長指示が口頭・チャットで届き、記録に残らない | 「言った言わない」問題が恒常化 |
| P2 | 給与計算（地域手当・資格手当等）が複雑で属人化 | 手作業ミスが多発。社労士側のミスも含む |
| P3 | 本人・経理・社労士・SmartHR への連絡・転記が手動 | 通知漏れ・入力ミス・工数の膨張 |
| P4 | 正社員以外（パート・登録訪問看護師）の履歴管理が不十分 | コンプライアンスリスク |
| P5 | 年間数百時間の工数ロス | 人事担当者の本来業務を圧迫 |

### 2.3 チャット分析（実データより）

既存チャットログの分類調査により、以下の業務カテゴリが確認されている。

| カテゴリ | 件数 | 優先度 |
|---------|------|--------|
| 給与・社保・手当関連 | 66件 | Phase 1 |
| 退職・休職・復職関連 | 45件 | Phase 2 |
| 入社・採用・面接関連 | 38件 | Phase 2 |
| その他 | 34件 | 分類のみ Phase 1 |
| 契約・労働条件変更関連 | 22件 | Phase 2 |
| 施設運営・異動・備品関連 | 12件 | Phase 2 以降 |
| 外国人・特定技能・ビザ関連 | 12件 | Phase 2 以降 |
| 研修・監査・事務手続き関連 | 9件 | Phase 2 以降 |
| 健康診断・面談関連 | 8件 | Phase 2 以降 |
| 勤怠・休暇管理関連 | 5件 | Phase 2 以降 |

---

## 3. Goals & Non-Goals

### 3.1 Goals（ゴール）

| # | ゴール |
|---|--------|
| G1 | 社長の自然言語チャット入力から、給与変更ドラフトを数秒以内に自動生成する |
| G2 | 人事担当者が Web 画面上でドラフトを確認・修正・承認できるワークフローを提供する |
| G3 | 承認後に、本人通知・社労士通知・スプレッドシート反映・SmartHR 更新を自動実行する |
| G4 | 誰がいつ何を指示し、AI がどう解釈し、誰が承認したかの完全な監査ログを残す |
| G5 | 正社員・パート・登録訪問看護師を含む全雇用形態の人事履歴を一元管理する |
| G6 | 全カテゴリの指示を自動分類・記録し、未対応タスクの可視化を実現する |

### 3.2 Non-Goals（非ゴール）

| # | 非ゴール | 理由 |
|---|----------|------|
| NG1 | 給与計算のルール自体の自動変更 | 給与規程の変更は経営判断であり、本システムのスコープ外 |
| NG2 | 勤怠管理・シフト作成 | 既存システムで対応済み。Phase 2 以降で連携検討 |
| NG3 | 採用活動（求人票作成・面接調整等） | 別プロダクトで対応予定 |
| NG4 | LLM による給与額の直接計算 | 金銭計算はプログラムコードで実施（精度・監査性の確保） |
| NG5 | SmartHR の全機能の代替 | SmartHR は引き続きマスターデータソースとして維持 |

---

## 4. Core Value Proposition

### Speed（速度）

- **Before**: 社長の指示 → 担当者が内容を解読 → 手計算 → 各所へ個別連絡（数日〜1週間）
- **After**: 社長が Chat に入力 → AI がドラフト生成（数秒） → 承認後に一括連携（数分）

### Accuracy（正確性）

- **Before**: ゼロから手作業で計算・入力 → ミス発生リスクが高い
- **After**: AI が作ったものを人間がチェックするレビュー型へ転換 → ミス検出率向上

### Transparency（透明性）

- **Before**: 指示が Chat に埋もれ、処理状況が不明
- **After**: 全指示・AI 解釈・承認フロー・連携結果をシステムに記録 → 「言った言わない」解消

---

## 5. User Stories & Personas

### Persona 1: 社長（最終意思決定者）

| 属性 | 内容 |
|------|------|
| 役割 | 給与変更・人事決定の最終決裁者 |
| 技術リテラシー | スマートフォン・Google Chat は日常的に使用 |
| ペイン | 細かい手続きに時間を取られたくない。決定を伝えたらあとは任せたい |

**ユーザーストーリー:**

- As a 社長, I want to Google Chat に「Aさんの給与を10ピッチ上げて」と打つだけで処理が始まること, so that 細かい手続きを自分でやらずに済む
- As a 社長, I want to 最終確認ボタンだけ押せばよいこと, so that 意思決定の証跡が残りつつ手間が最小化される
- As a 社長, I want to 指示した内容が正確に実行されたことを確認できること, so that 実行ミスを早期に発見できる

### Persona 2: 人事担当者（オペレーター）

| 属性 | 内容 |
|------|------|
| 役割 | 日次の人事業務執行・各所への連絡 |
| 技術リテラシー | Web アプリケーション・スプレッドシートを業務利用 |
| ペイン | 転記・通知漏れが怖い。給与計算ミスで指摘を受けたくない |

**ユーザーストーリー:**

- As a 人事担当者, I want to AI が作った給与変更ドラフトを Web 画面で確認し微調整できること, so that 計算の正確性を確保しつつ手作業を削減できる
- As a 人事担当者, I want to 承認後に本人・社労士・SmartHR への連絡が自動化されること, so that 通知漏れや転記ミスをゼロにできる
- As a 人事担当者, I want to 未対応の指示タスクを一覧で確認できること, so that 対応漏れを防げる

### Persona 3: 一般社員（情報受信者）

| 属性 | 内容 |
|------|------|
| 役割 | 自身の給与・労働条件の変更を受け取る側 |
| ペイン | 給与変更の通知が遅い・間違っていることがある |

**ユーザーストーリー:**

- As a 一般社員, I want to 自分の給与変更通知や辞令を、正確な内容でタイムリーに受け取ること, so that 自身の処遇変更を安心して確認できる

---

## 6. Functional Requirements

### 6.1 Chat 受信・解析機能

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-C01 | Google Chat の指定スペース（人事関連、有川チームPJT）を監視し、新規メッセージを取得する | Must |
| FR-C02 | バックオフィスからの連絡事項スペースは監視対象外とする | Must |
| FR-C03 | Vertex AI (Gemini) を用いてメッセージの業務カテゴリを自動分類する（10カテゴリ） | Must |
| FR-C04 | 給与変更・入社・退職等の人事アクションを含むメッセージを検出し、構造化データとして抽出する | Must |
| FR-C05 | 解析完了後、Chat スペースに「受け付けました」旨のレスポンスを数秒以内に返す | Must |
| FR-C06 | AI が解釈できなかった・確認が必要なメッセージについては、Chat 上で確認メッセージを返す | Should |

### 6.2 給与変更ドラフト生成機能

#### 6.2.1 機械的変更（ルールベース）

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-S01 | 資格取得による給与変更など、給与規程に基づく変更はプログラムコードで正確に計算する | Must |
| FR-S02 | Pitch（給与等級ポイント）の変更指示（例: 「10ピッチ上げて」）を解釈し、現在の Pitch + 変更量 = 新 Pitch を算出する | Must |
| FR-S03 | 地域手当・資格手当・各種控除を給与規程ルールに従ってプログラムで計算する | Must |
| FR-S04 | ドラフト生成時に変更前・変更後の比較（Before/After）を明示する | Must |

#### 6.2.2 裁量的変更（社長承認必須）

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-S05 | 「給与30万で設定して」のような総額指定の場合、複数の手当構成パターンを提示する | Must |
| FR-S06 | 裁量的変更の場合、必ず社長承認ステップをワークフローに含める | Must |

### 6.3 Web 管理画面（ダッシュボード）

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-W01 | 生成されたドラフトの一覧表示（ステータス: 未承認・承認済・差戻し・実行済） | Must |
| FR-W02 | ドラフトの詳細表示（変更前・変更後の比較 UI） | Must |
| FR-W03 | 人事担当者による手当の微調整・編集機能 | Must |
| FR-W04 | 社長・人事担当者による承認・差戻しアクション | Must |
| FR-W05 | 分類されたメッセージ・タスクの全件一覧（フィルタ・検索付き） | Must |
| FR-W06 | 未対応タスクのアラート表示 | Must |
| FR-W07 | 監査ログ画面（指示者・解釈結果・承認者・実行結果・タイムスタンプ） | Must |
| FR-W08 | 従業員マスタ（正社員・パート・登録訪問看護師を含む全雇用形態） | Must |
| FR-W09 | Google 認証（Google Workspace アカウント）によるログイン | Must |
| FR-W10 | ロールベースのアクセス制御（社長・人事担当者・閲覧専用） | Must |

### 6.4 承認後の連携機能（Phase 1 対象）

| ID | 要件 | 優先度 | 連携先 |
|----|------|--------|--------|
| FR-I01 | 本人への変更通知送信（Google Chat または メール） | Must | 本人 |
| FR-I02 | 社労士事務所への共有（PDF または 構造化メール） | Must | 社労士 |
| FR-I03 | 職員給与一覧スプレッドシートへの自動反映 | Must | Google Sheets |
| FR-I04 | SmartHR の従業員情報更新（Phase 2 で本格対応、Phase 1 では通知のみ可） | Should | SmartHR |
| FR-I05 | 各種権限変更（必要な場合は担当者へのタスク生成） | Should | 内部 |

### 6.5 状態遷移

給与変更ドラフトの状態遷移は以下の通り。行き止まり（終端以外の遷移不能状態）がないことを保証する。

```
[DRAFT（生成済）]
    │
    ├─→ [REVIEW（人事担当者確認中）]
    │       │
    │       ├─→ [PENDING_APPROVAL（社長承認待ち）]  ← 裁量的変更の場合
    │       │       │
    │       │       ├─→ [APPROVED（承認済）]
    │       │       └─→ [REJECTED（差戻し）] ─→ [REVIEW] （再編集）
    │       │
    │       └─→ [APPROVED（承認済）]  ← 機械的変更（人事担当者が承認）
    │
    └─→ [REJECTED（差戻し）] ─→ [DRAFT] （AI 再生成）

[APPROVED]
    └─→ [EXECUTING（連携処理中）]
            │
            ├─→ [COMPLETED（完了）]  ← 終端
            └─→ [FAILED（失敗）] ─→ [EXECUTING] （リトライ）または [REVIEW] （手動介入）
```

> **注意**: ステータスフィールドによる処理状態管理を採用。状態遷移図は実装前に行き止まりがないことをレビューすること（CLAUDE.md 準拠）。

---

## 7. Non-Functional Requirements

### 7.1 正確性

| ID | 要件 |
|----|------|
| NFR-A01 | 給与・手当の金銭計算は LLM に依存せず、プログラムコード（決定論的ロジック）で実施する |
| NFR-A02 | AI の解釈結果（intent, entity 抽出）は必ず人間が確認するステップを経てから実行する |
| NFR-A03 | SmartHR のデータとアプリ内データの整合性を保ち、ヌケモレが発生しない業務フローを設計する |

### 7.2 監査性

| ID | 要件 |
|----|------|
| NFR-AU01 | 誰がいつ何を指示したか（Chat メッセージ原文・送信者・タイムスタンプ）を永続的に保存する |
| NFR-AU02 | AI がどのように解釈したか（抽出した intent・entity・信頼スコア）をログに記録する |
| NFR-AU03 | 誰がいつ承認・差戻しを行ったか（操作者・タイムスタンプ・コメント）を記録する |
| NFR-AU04 | 連携処理の実行結果（成功・失敗・エラー詳細）を記録する |
| NFR-AU05 | ログは改ざん不可の形式で保存し、監査時に検索・エクスポートが可能であること |

### 7.3 セキュリティ・アクセス管理

| ID | 要件 |
|----|------|
| NFR-S01 | 給与情報は PII（個人識別情報）として扱い、暗号化・アクセスログを徹底する |
| NFR-S02 | Web 管理画面は Google Workspace 認証（OAuth 2.0）でのみアクセス可能とする |
| NFR-S03 | ロールベースアクセス制御（RBAC）を実装し、職位・役割に応じて参照・操作権限を制御する |
| NFR-S04 | Firestore へのアクセスは firebase-admin SDK（ADC 認証）経由に限定し、クライアント直接アクセスを禁止する |
| NFR-S05 | SmartHR・Google Sheets 等の API キーは Secret Manager で管理し、ハードコーディング禁止 |

### 7.4 パフォーマンス・可用性

| ID | 要件 |
|----|------|
| NFR-P01 | Google Chat へのレスポンス（受付確認メッセージ）は 5 秒以内に返す |
| NFR-P02 | 給与変更ドラフトの生成完了は 30 秒以内とする |
| NFR-P03 | Web 管理画面のページ初期表示は 3 秒以内とする |
| NFR-P04 | 月末・給与締め処理時など高負荷時も安定稼働できる設計とする（Cloud Run のオートスケーリング活用） |

### 7.5 保守性・拡張性

| ID | 要件 |
|----|------|
| NFR-M01 | 業務カテゴリ・給与規程ルールの変更に対して、コード修正を最小化できる設計とする |
| NFR-M02 | 新しい外部連携先の追加がモジュール追加で対応できるアーキテクチャとする |
| NFR-M03 | AI モデル（Gemini バージョン）の更新に対して、プロンプト・インターフェースを分離した設計とする |

---

## 8. Phased Delivery Plan

### Phase 1: MVP（〜3ヶ月）

**テーマ**: 給与変更の自動化と全カテゴリの記録化

| # | 機能 | 詳細 |
|---|------|------|
| 1 | Chat 受信・分類 | 監視スペースのメッセージを受信し、10カテゴリに自動分類して記録 |
| 2 | 給与変更ドラフト生成 | Pitch 変更・手当変更のドラフトを自動生成（Before/After 表示） |
| 3 | Web 承認フロー | ドラフト確認・編集・承認・差戻しの管理画面 |
| 4 | スプレッドシート書き出し | 承認後に職員給与一覧 SS へ自動反映 |
| 5 | 本人・社労士通知 | 承認後に本人・社労士へ自動通知 |
| 6 | 監査ログ | 全操作の完全ログ記録と参照画面 |
| 7 | SmartHR 通知 | Phase 1 では SmartHR への更新タスク生成のみ（API 連携は Phase 2） |

**成功基準**:
- 給与変更処理の平均リードタイム 50% 削減
- 計算ミスの発生件数 0 件/月（承認後実行分）
- 全指示の記録率 100%

### Phase 2: 本格展開（〜6ヶ月）

**テーマ**: 入社フロー・SmartHR 連携・自動化範囲の拡大

| # | 機能 | 詳細 |
|---|------|------|
| 1 | SmartHR API 連携 | 承認後の SmartHR 自動更新（完全自動化） |
| 2 | 入社手続きフロー | 採用決定後の各所連絡・SmartHR 登録・権限設定の自動化 |
| 3 | PDF 自動生成 | 給与変更通知書・辞令等の PDF 自動作成・送付 |
| 4 | 退職・休職フロー | 退職・休職・復職の各種手続き自動化 |
| 5 | 契約・労働条件変更 | 契約種別変更・労働条件変更のドラフト生成 |
| 6 | AI 精度向上 | フィードバックループの構築（承認・差戻し実績を学習データとして活用） |

---

## 9. Success Metrics

### ビジネス指標

| 指標 | 現状（ベースライン） | Phase 1 目標 | Phase 2 目標 |
|------|---------------------|--------------|--------------|
| 給与変更処理リードタイム | 数日〜1週間 | 1日以内 | 数時間以内 |
| 計算ミス発生件数 | 月複数件 | 0件/月 | 0件/月 |
| 処理工数（人事担当者） | 年数百時間 | 50% 削減 | 70% 削減 |
| 指示の記録率 | 不明（推定 30%以下） | 100% | 100% |

### システム指標

| 指標 | 目標値 |
|------|--------|
| Chat レスポンス時間 | 95 パーセンタイルで 5 秒以内 |
| ドラフト生成時間 | 95 パーセンタイルで 30 秒以内 |
| AI 分類精度 | 正解率 90% 以上（人手評価） |
| システム稼働率 | 99.5% 以上（月次） |

### ユーザー満足度

| 指標 | 測定方法 | 目標 |
|------|----------|------|
| 社長の操作ステップ数 | Chat 入力 + 承認ボタンのみ | 2 ステップ以内 |
| 人事担当者の承認所要時間 | システムログより計測 | 平均 5 分以内 |
| 差戻し率（AI ドラフト品質） | 差戻し件数 / 総件数 | 20% 以下 |

---

## 10. Risks & Mitigations

| # | リスク | 影響度 | 発生確率 | 対策 |
|---|--------|--------|----------|------|
| R1 | AI による給与計算の誤解釈 | 高 | 中 | 金銭計算はプログラムコードで実施。AI は intent/entity 抽出のみに使用。必ず人間の確認ステップを挟む |
| R2 | SmartHR API 仕様変更による連携断絶 | 高 | 中 | SmartHR 連携モジュールを分離。API バージョン固定・変更通知の監視体制を整備 |
| R3 | 給与情報の漏洩（セキュリティインシデント） | 高 | 低 | Google 認証・RBAC・Firestore ADC 認証・Secret Manager 活用。定期的な脆弱性診断 |
| R4 | 社長・人事担当者の利用定着失敗 | 高 | 中 | UX を極限まで単純化（社長は Chat 入力のみ）。導入初期の伴走サポートを計画 |
| R5 | 給与規程変更時のロジック未更新 | 中 | 高 | 給与規程ルールをコード・設定ファイルに明示的に定義。規程変更時の更新手順をドキュメント化 |
| R6 | スプレッドシート・SmartHR との二重管理による不整合 | 中 | 中 | Phase 1 では同期後に整合性チェックを自動実行。Phase 2 で SmartHR を Single Source of Truth に一本化 |
| R7 | Vertex AI (Gemini) のレイテンシ増大 | 低 | 中 | Chat への即時レスポンス（受付確認）と AI 処理を非同期化。Pub/Sub によるキューイング |
| R8 | パート・登録訪問看護師の履歴管理が後回しになる | 中 | 中 | 従業員マスタの設計段階から全雇用形態を対象に含める（Phase 1 スコープ内） |

---

## 11. Appendix

### 11.1 用語集

| 用語 | 定義 |
|------|------|
| Pitch（ピッチ） | 社内給与等級体系のポイント単位。「10ピッチ上げる」は等級ポイントを10増加させること |
| ドラフト（Draft） | AI が生成した給与変更案。人間の確認・承認を経て確定する |
| Human-in-the-loop | AI の処理結果を人間が必ず確認・承認するワークフロー設計 |
| SmartHR | 人事労務 SaaS。従業員情報・給与情報のマスターデータソースとして運用 |
| 社労士 | 社会保険労務士。給与計算・社会保険手続きの外部委託先 |
| RBAC | Role-Based Access Control. 役割ベースのアクセス制御 |
| PII | Personally Identifiable Information. 個人識別情報 |
| Single Source of Truth | データの唯一の正とする情報源。本システムでは Phase 2 以降 SmartHR を SSOT として位置づける |

### 11.2 監視対象チャットスペース

| スペース名 | 監視 | 備考 |
|-----------|------|------|
| 人事関連（全社共通） | 対象 | メイン監視スペース |
| 有川チーム（PJT...） | 対象 | プロジェクト関連の人事指示を含む |
| バックオフィスからの連絡事項 | 対象外 | 一方向の連絡事項のみのため除外 |

### 11.3 技術スタック概要

| レイヤ | 採用技術 | 備考 |
|--------|----------|------|
| Frontend | Next.js (React) | Web 管理画面 |
| Backend | Cloud Run (GCP) | コンテナベースのサーバーレス |
| Database | Firestore + BigQuery | 従業員・給与・ログデータ |
| AI | Vertex AI (Gemini) | メッセージ解析・分類 |
| Chat 連携 | Google Chat API + Pub/Sub | メッセージ受信・送信 |
| 外部連携 | SmartHR API, Google Sheets API | 承認後の自動連携 |
| 認証 | Google OAuth 2.0 | Google Workspace アカウント連携 |
| シークレット管理 | GCP Secret Manager | API キー・接続情報 |

### 11.4 承認後の連携先（優先順位付き）

承認完了後、以下の順序で連携処理を実行する。

1. **本人通知** — Google Chat または メール（最優先。当事者への迅速な通知）
2. **社労士事務所共有** — PDF または構造化メール（給与計算・社会保険手続きに必要）
3. **職員給与一覧 SS 反映** — Google Sheets API（経理・給与管理の基幹台帳）
4. **SmartHR 変更** — SmartHR API（Phase 1: タスク生成のみ、Phase 2: API 自動更新）
5. **各種権限変更** — 必要な場合は担当者へのタスク生成（システム管理者対応）

---

*このドキュメントは PRD-001 として管理されます。変更時はバージョンを更新し、変更履歴をこのセクション末尾に追記してください。*

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|----------|
| 1.0.0 | 2026-02-18 | - | 初版作成 |
